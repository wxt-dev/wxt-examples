<!-- Generated by scripts/generate-diffs.ts -->

# Messaging - Long Lived Connections

> Based off the [`vanilla`](https://github.com/wxt-dev/wxt/tree/main/templates/vanilla) template.
>
> ```sh
> npx wxt@latest init --template vanilla
> ```

This example demonstrates how to send messages to and from your background script using long-lived connections.

First, we need to setup a port to let other context's connect to.

###### entrypoints/background.ts

```diff
@@ -1,3 +1,13 @@
 export default defineBackground(() => {
   console.log('Hello background!', { id: browser.runtime.id });
+
+  browser.runtime.onConnect.addListener((port) => {
+    if (port.name !== 'example') return;
+
+    port.onMessage.addListener((message) => {
+      console.log('Background recieved:', message);
+      console.log('Background sending:', 'pong');
+      port.postMessage('pong');
+    });
+  });
 });
```

Then in our other files, like content scripts, options page, or popup, you need to connect to the port with the same name to send a message.

###### entrypoints/popup/main.ts

```diff
@@ -19,6 +19,13 @@ document.querySelector<HTMLDivElement>('#app')!.innerHTML = `
       Click on the WXT and TypeScript logos to learn more
     </p>
   </div>
 `;

 setupCounter(document.querySelector<HTMLButtonElement>('#counter')!);
+
+const port = browser.runtime.connect({ name: 'example' });
+port.onMessage.addListener((message) => {
+  console.log('Popup recieved:', message);
+});
+console.log('Popup sending:', 'ping');
+port.postMessage('ping');
```

With this code, you should see messages sent to and from the background when the popup is opened.

```
Popup sending: ping
Background recieved: ping
Background sending: pong
Popup recieved: pong
```
